<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* Popup container */
  .popup { 
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: inline-block;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

  /* The actual popup */
  .popup .popuptext {
    visibility: hidden;
    width: 160px;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px 0;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -80px;
  }

  /* Popup arrow */
  .popup .popuptext::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #555 transparent transparent transparent;
  }

/* Toggle this class - hide and show the popup */
  .popup .show {
    visibility: visible;
    -webkit-animation: fadeIn 1s;
    animation: fadeIn 1s;
  }

/* Add animation (fade in the popup) */
  @-webkit-keyframes fadeIn {
    from {opacity: 0;} 
    to {opacity: 1;}
  }

  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity:1 ;}
  }
</style>
</head>

<body>

    <div id="thevizcolumn" style="width:100%; height:2160px; float: left; background-color:rgb(90, 119, 163);">
      <p><b><center><font face="Helvetica">1854 London Cholera Outbreak Data</font></center></b></p>
      <div style="width:50%; height:400px; float: left">
      <div id="plot1" style="width:100%;height:400px;" ></div>
      </div>
      <div style="width:50%; height:400px; float: left">
      <div id="chart1" style="width:100%;height:400px;" ></div>
      </div>
      <div style="width:50%; height:400px; float: left">
        <div id="plot2" style="width:100%;height:400px;" ></div>
        </div>
    </div>

    <div class="popup" onclick="myFunction()"><b><i>Click for background info.</i></b>
      <span class="popuptext" id="myPopup">Webpage by Leon Qu (leonq@hawaii.edu).
                                          Data visualized with Plotly and Leaflet.
                                          Data on 1854 London cholera outbreak compiled by Robin Wilson.
      </span>
    </div>

<script>

  Plotly.d3.tsv("https://raw.githubusercontent.com/ungarz/cholera/master/choleraDeaths.tsv", 
    function(err, rows){
      function unpack(rows, key) {
    return rows.map(function(row) { return row[key]; });
    }

    var headerNames = Plotly.d3.keys(rows[0]);

  var headerValues = [];
  var cellValues = [];
  for (i = 0; i < headerNames.length; i++) {
    headerValue = [headerNames[i]];
    headerValues[i] = headerValue;
    cellValue = unpack(rows, headerNames[i]);
    cellValues[i] = cellValue;
  }

  // clean date
  for (i = 0; i < cellValues[1].length; i++) {
  var dateValue = cellValues[1][i].split(' ')[0]
  cellValues[1][i] = dateValue
  }

  var data1 = [{
  type: 'table',
  columnwidth: [600,500,500],
  columnorder: [0,1,2],
  header: {
    values: headerValues,
    align: "center",
    line: {width: 1, color: 'rgb(50, 50, 50)'},
    fill: {color: ['rgb(235, 100, 230)']},
    font: {family: "Arial", size: 11, color: "white"}
  },
  cells: {
    values: cellValues,
    align: ["center", "center"],
    line: {color: "black", width: 1},
    fill: {color: ['rgba(228, 222, 249, 0.65)','rgb(235, 193, 238)', 'rgba(228, 222, 249, 0.65)']},
    font: {family: "Arial", size: 11, color: ["black"]}
  }
  }]

  var sumOfAttacks = [Plotly.d3.sum(data.map(function(d){return d.Attack}))];
  var sumOfDeaths = [Plotly.d3.sum(data.map(function(d){return d.Death}))];

  var layout1 = {
  title: "Cholera Attacks and Deaths by Date"
  }

  var table1 = Plotly.plot('chart1', data1, layout1);

    var trace1 = {
        x: unpack(rows, 'Date'),
        y: unpack(rows, 'Attack'),
        mode: 'lines+markers',
        name: '# of attacks on day',
        line: {
          color: 'rgb(219, 64, 82)',
          width: 3
        }
    };
  
    var trace2 = {
        x: unpack(rows, 'Date'),
        y: unpack(rows, 'Death'),
        mode: 'lines+markers',
        name: '# of deaths on day',
        line: {
          color: 'rgb(55, 128, 191)',
          width: 3
        }
    };
  
    var trace3 = {
        x: unpack(rows, 'Date'),
        y: sumOfAttacks,
        mode: 'markers',
        name: 'Total # of attacks up to day'
    };

    var trace4 = {
      x: unpack(rows, 'Date'),
      y: sumOfDeaths,
      mode: 'markers',
      name: 'Total # of deaths up to day'
    };
  
    var data = [trace1, trace2, trace3, trace4];
  
    var layout = {
        title: 'Cholera Attacks and Deaths',
        xaxis: {
        title: 'Dates'
    },
      yaxis: {
        title: 'Number of People'
      }
    };
  
  var graph1 = Plotly.newPlot('plot1', data, layout);
  });

  function myFunction() {
    var popup = document.getElementById("myPopup");
    popup.classList.toggle("show");
  }
</script>
</body>